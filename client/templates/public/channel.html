<template name="channel">
    {{#with channel}}
    <div class=playerbody>
      <section>
        <div class="headleft">
          <h1 class="roomtitle">{{title}}</h1>
          <h4 class="roomdesc">{{query}}</h4>
         </div>
       <div class="headright" style="float:right;">
          <!-- <input type="text" name="search" class="textbox" placeholder="Request Song..."> -->{{> searchBox}}<p></p>
                    <a href="https://twitter.com/share" class="twitter-share-button" data-text="Listening to {{title}} on DJ-Cast" data-via="djcast_">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        </div>
      </section>
      {{#with currentSong}}
        <div class="player">

        
        <!-- <img src="http://www.billboard.com/files/styles/gallery_main_well_2/public/media/M-I-A-Kala-album-covers-billboard-1000x1000.jpg" class="playerimg"> -->
        {{#if isModerator}}
        {{> Moderator videoId=videoID }}

        {{else}}
        <img src="{{thumbnail}}" class="playerimg">
        {{/if}}

        <div class="playermeta">
        <h3 class="songname">{{title}}</h3>
        </div>

        </div>
      {{/with}}
    </div>
	{{/with}}
</template>


<template name="searchBox">
  <input type="text" id="search-box" placeholder="search youtube here">
  <div class="list-group">
  {{#each getSearchResults}}
      <a href="#" class="list-group-item">
      <div class="row">
        <div class="col-md-1">
          <img src="{{snippet.thumbnails.default.url}}" class="img-responsive"/>
        </div>
        <div class="col-md-11">
          <h4 class="list-group-item-heading">{{snippet.title}}</h4>
        </div>
      </div>
      </a>
  {{/each}}
  </div>
</template>


<template name="Moderator">
  <div id="player"></div>
  <br>
  <!--<label id="title" ></label>
  <br>
  <span style="display: inline;">
    <label id="elapsed"></label>
    <label >/</label>
    <label id="duration"></label>
  </span>
  <br>-->
  <span style="display: inline;">
    <input id="playPauseButton" type="button" value="Pause" OnClick="playPauseClick()"/>
    <input id="skipButton" type="button" value="Skip" OnClick="skipClick()"/>
  </span>

  <script>
    var tag = document.createElement('script');
  
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
  
    var player;
    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '400',
        width: '600',
        videoId: '{{videoId}}',
        playerVars: {
          'autoplay': 1,
          'controls': 0,
          'disablekb': 1,
          'enablejsapi': 1,
          'rel': 0
        },
        events: {
          'onReady': onPlayerReady,
          'onStateChange': onPlayerStateChange
        }
      });
    }

    function onPlayerReady(event) {
      //document.getElementById("title").innerText = player.getVideoData().title;
      //document.getElementById("duration").innerText = player.getDuration;
      event.target.playVideo();
    }

    function onPlayerStateChange(event) {
      if (event.data == YT.PlayerState.ENDED) {
        var channelId = FlowRouter.getParam('id');
        Meteor.call('/song/remove', Song.getLatest(channelId).fetch()[0], function(err, res) { 
          if (err) {}
            if (Song.getLatest(channelId).fetch()[0]) {
              player.loadVideoById(Song.getLatest(channelId).fetch()[0].videoID, 0, "default");
              player.playVideo();
            }
        });
        //document.getElementById("title").innerText = player.getVideoData().title;
        //document.getElementById("duration").innerText = player.getDuration();
      }
    }

    function playPauseClick(){
      var button = document.getElementById("playPauseButton");
        if(button.value == "Pause"){
          button.value = "Play";
          player.pauseVideo();
        }
        else{
        button.value = "Pause";
        player.playVideo()
      }

    }

    


  </script>
  <!--{{> myButtons}}-->
</template>


